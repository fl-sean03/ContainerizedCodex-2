version: "3.9"

services:
  backend:
    build: ./backend
    container_name: codex-backend
    ports:
      - "8000:8000"
    env_file:
      - .env
      - .env.live
    environment:
      HOST_WORKSPACES_DIR: "${PWD}/backend/workspaces"
    volumes:
      - ./backend/workspaces:/app/workspaces
      - ./worker/dummy_snake_template:/app/worker/dummy_snake_template:ro
      - /var/run/docker.sock:/var/run/docker.sock
    depends_on:
      - worker

  worker:
    build: ./worker
    image: codex-worker:latest
    container_name: codex-worker
    # In this skeleton, worker is used via `docker run` command, not as a long-lived service.
    # You can re-architect later (e.g. message queue + worker pool).
    command: ["sleep", "infinity"]
